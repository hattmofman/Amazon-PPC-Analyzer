<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PPC Analyzer - Amazon Advertising Analytics</title>
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- React and ReactDOM -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  
  <!-- Babel Standalone for JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <!-- Recharts -->
  <script src="https://unpkg.com/recharts@2.5.0/dist/Recharts.js"></script>
  
  <!-- SheetJS (xlsx) -->
  <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
  
  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>
  
  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  
  <style>
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
        'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
        sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    
    #root {
      min-height: 100vh;
    }
    
    /* Loading spinner */
    .loader {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #3498db;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    // Initialize Supabase client
    const { createClient } = supabase;
    const SUPABASE_URL = 'https://qlqqdrnddwtzguqgtrub.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFscXFkcm5kZHd0emd1cWd0cnViIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMwNjIyMzMsImV4cCI6MjA3ODYzODIzM30.UllszW_ETPYHNGBjOKPR6wJD4lHQZPiQ-vJCF9h8wWc';
    
    const supabaseClient = createClient(SUPABASE_URL, SUPABASE_KEY);
    
    // Export Supabase client globally for the App component to use
    window.supabaseClient = supabaseClient;
    
    // Make Recharts components available globally
    const { BarChart, Bar, LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } = Recharts;
    window.Recharts = { BarChart, Bar, LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer };
    
    // Make XLSX available globally
    window.XLSX = XLSX;
    
    // Create Lucide React components
    const createLucideIcon = (iconName) => {
      return (props) => {
        const ref = React.useRef(null);
        React.useEffect(() => {
          if (ref.current) {
            lucide.createIcons({
              icons: { [iconName]: lucide[iconName] },
              attrs: {
                ...props,
                'stroke-width': props.strokeWidth || 2,
              },
            });
          }
        }, []);
        return React.createElement('i', { 
          ref, 
          'data-lucide': iconName,
          ...props 
        });
      };
    };
    
    // Export Lucide icons
    window.LucideIcons = {
      Upload: createLucideIcon('upload'),
      TrendingUp: createLucideIcon('trending-up'),
      TrendingDown: createLucideIcon('trending-down'),
      DollarSign: createLucideIcon('dollar-sign'),
      Target: createLucideIcon('target'),
      MousePointer: createLucideIcon('mouse-pointer'),
      AlertTriangle: createLucideIcon('alert-triangle'),
      CheckCircle: createLucideIcon('check-circle'),
      XCircle: createLucideIcon('x-circle'),
      Filter: createLucideIcon('filter'),
      Search: createLucideIcon('search'),
      Download: createLucideIcon('download'),
      ChevronDown: createLucideIcon('chevron-down'),
      ChevronRight: createLucideIcon('chevron-right'),
      ArrowUpDown: createLucideIcon('arrow-up-down'),
      Settings: createLucideIcon('settings'),
      Loader2: createLucideIcon('loader-2'),
      FileSpreadsheet: createLucideIcon('file-spreadsheet'),
    };
  </script>
  
  <!-- Load App.js -->
  <script type="text/babel" src="./App.js"></script>
  
  <script type="text/babel">
    const { useState, useEffect } = React;
    const root = ReactDOM.createRoot(document.getElementById('root'));
    
    // Main component wrapper to handle Supabase auth state
    function AppWrapper() {
      const [loading, setLoading] = useState(true);
      const [session, setSession] = useState(null);
      
      useEffect(() => {
        // Get initial session
        supabaseClient.auth.getSession().then(({ data: { session } }) => {
          setSession(session);
          setLoading(false);
        });
        
        // Listen for auth changes
        const {
          data: { subscription },
        } = supabaseClient.auth.onAuthStateChange((_event, session) => {
          setSession(session);
        });
        
        return () => subscription.unsubscribe();
      }, []);
      
      if (loading) {
        return (
          <div style={{ 
            display: 'flex', 
            justifyContent: 'center', 
            alignItems: 'center', 
            height: '100vh',
            flexDirection: 'column',
            gap: '1rem'
          }}>
            <div className="loader"></div>
            <p style={{ color: '#666' }}>Loading PPC Analyzer...</p>
          </div>
        );
      }
      
      return <App session={session} supabase={supabaseClient} />;
    }
    
    root.render(<AppWrapper />);
  </script>
</body>
</html>
